<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>LÖVE cookbook | Metatables</title>

    <script src="/love-cookbook/assets/js/codeblock.js"></script>
    <script src="/love-cookbook/assets/js/hover_preview.js"></script>

    <link rel="stylesheet" href="/love-cookbook/assets/styles/fonts.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/main.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/prism.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/markdown.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="sidebar">
      <header>
        <a href="/love-cookbook/">
            <div class="logo">
                <img class="logo-unhover-img" src="/love-cookbook/assets/logo.png">
                <img class="logo-hover-img" src="/love-cookbook/assets/logo_hover.png">
            </div>

            <h1>LÖVE Cookbook</h1>
        </a>
      </header>

      <nav>
        <ul><li class="group-header"><ul><li><a class="" href="/love-cookbook/guides/getting-started/">Getting started</a>
                  </li></ul>
            </li><li class="group-header">Installation<ul><li><a class="" href="/love-cookbook/guides/installation/love/">LÖVE</a>
                  </li><li><a class="" href="/love-cookbook/guides/installation/vscode/">VSCode</a>
                  </li><li><a class="" href="/love-cookbook/guides/installation/neovim/">Neovim</a>
                  </li></ul>
            </li><li class="group-header">Lua Basics<ul><li><a class="" href="/love-cookbook/guides/fundamentals/lua/">Lua</a>
                  </li><li><a class="" href="/love-cookbook/guides/fundamentals/variables/">Variables</a>
                  </li><li><a class="" href="/love-cookbook/guides/fundamentals/functions/">Functions</a>
                  </li><li><a class="" href="/love-cookbook/guides/fundamentals/if-statements/">If-statements</a>
                  </li><li><a class="" href="/love-cookbook/guides/fundamentals/tables/">Tables and For-loops</a>
                  </li><li><a class="" href="/love-cookbook/guides/fundamentals/recap/">Recap</a>
                  </li></ul>
            </li><li class="group-header">Lua Intermediate<ul><li><a class="" href="/love-cookbook/guides/lua-intermediate/require/">Require</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/scope/">Scope</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/modulo/">Modulo</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/nested-for-loops/">Nested for-loops</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/ternary-operators/">Ternary operators</a>
                  </li><li><a class="active" href="/love-cookbook/guides/lua-intermediate/metatables/">Metatables</a>
                  </li></ul>
            </li><li class="group-header">LÖVE Basics<ul><li><a class="" href="/love-cookbook/guides/love/drawing-a-rectangle/">Drawing a rectangle</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/drawing-image/">Drawing an image</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/playing-sound/">Playing sound</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/input/">Input</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/filesystem/">Filesystem</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/deltatime/">Deltatime</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/reading-errors/">Reading errors</a>
                  </li></ul>
            </li><li class="group-header">Basics<ul><li><a class="" href="/love-cookbook/guides/basic/aabb/">AABB</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/angle-and-distance/">Angle &amp; distance</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/tiles/">Tiles</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/animation/">Animation</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/saving-and-loading/">Saving &amp; loading</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/canvases/">Canvases</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/stencil-modes/">Stencil modes</a>
                  </li></ul>
            </li><li class="group-header">Intermediate<ul><li><a class="" href="/love-cookbook/guides/intermediate/oop/">OOP</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/collision-resolving/">Collision resolution</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/stencil-states/">Stencil states</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/coroutines/">Coroutines</a>
                  </li></ul>
            </li><li class="group-header">Advanced<ul><li><a class="" href="/love-cookbook/guides/advanced/physics/">Physics</a>
                  </li><li><a class="" href="/love-cookbook/guides/advanced/threads/">Threads</a>
                  </li></ul>
            </li></ul>
      </nav>
    </div>

    <main>
      <article class="guide">
        
<h1>Metatables</h1>

<p>With <strong>metatables</strong> we can enhance our tables, making them a very powerful tool. It works by creating a second table that we assign as a <ins>metatable</ins> to our main table. The metatable has <strong>metamethods</strong> which are special functions that influence how our table works.</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p>&quot;Meta&quot; means referring to itself. It's called a <ins>meta</ins>table because it is influencing the table itself.</p>
<p>A <strong>method</strong> is what we call a <ins>function</ins> assigned to an <ins>object</ins>.</p>
</div>
<pre><code class="language-lua"><span data-attrs=""></span><span class="token keyword">local</span> my_table <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">local</span> my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
my_metatable<span class="token punctuation">.</span>__call <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span>

<span class="token function">my_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Output: Hello world!</span>
</code></pre>
<p>We create a table <code>my_table</code>, and a second table <code>my_metatable</code>. We give the table the property <code>__call</code>. This is a <ins>metamethod</ins>. Next we use the function <code>setmetatable(table, metatable)</code>. The first argument is our table, the second argument the metatable we want to apply to it.</p>
<p>On the last line, we can finally see the power of metatables. We can <ins>call</ins> our table, as if it's a function. When we do, it triggers the event <code>call</code>, and calls the <ins>metamethod</ins> we assigned to <code>__call</code>.</p>
<div class="markdown-alert markdown-alert-important"><p class="markdown-alert-title"><svg class="octicon octicon-report mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p>We have often stated that the name of a variable does not matter. That is different in this case. The keys for the metamethods are predefined. <a href="https://www.lua.org/manual/5.1/manual.html#2.8">See the list of all the events.</a></p>
</div>
<p>We won't be looking at all the events, but there are two important ones that deserve our attention. <code>index</code> and <code>newindex</code>.</p>
<h2 id="newindex" tabindex="-1">newindex <a class="anchor" href="#newindex">#</a></h2>
<p>Let's say we want to prevent extra properties to be assigned to our table. With a <code>__newindex</code> metamethod we can make this happen.</p>
<pre><code class="language-lua"><span data-attrs=""></span><span class="token keyword">local</span> my_table <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">local</span> my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

my_metatable<span class="token punctuation">.</span>__newindex <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"No new assignments allowed!"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

my_table<span class="token punctuation">.</span>animal <span class="token operator">=</span> <span class="token string">"whale"</span>
<span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span>
my_table<span class="token punctuation">.</span>fruit <span class="token operator">=</span> <span class="token string">"apple"</span> <span class="token comment">-- Error!</span>
</code></pre>
<p>We first assign the property <code>animal</code>. All is fine, because we haven't set the metatable yet. But after setting the metatable, we get an error when assigning the property <code>fruit</code>. The <code>newindex</code> event has been triggered, the metamethod called, and the error thrown.</p>
<p>The first parameter of <code>__newindex</code> is the table. Why would we need the table? Don't we already know what table we try to assign a property to? Well no, because the same metatable can be set to multiple tables, meaning we won't know which of those tables has triggered the event to call the metamethod.</p>
<p>If we actually want the assignment to happen, we can't do <code>t[key] = value</code>. This would trigger the same event again, causing an infinite loop. Instead, we need to use <code>rawset(t, key, value)</code>. This is a special function that sets the value without triggering the event.</p>
<p>But what's the point of metamethods if we do a normal assignment? Let's have some fun with it, and create a table that magically doubles all the numbers we assign to it.</p>
<pre><code class="language-lua"><span data-attrs=""></span><span class="token keyword">local</span> my_table <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">local</span> my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">-- It doesn't matter whether we set the metatable</span>
<span class="token comment">-- before or after assigning the metamethods.</span>
<span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span>

my_metatable<span class="token punctuation">.</span>__newindex <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token function">rawset</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

my_table<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
my_table<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span>
my_table<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">80</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>my_table<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">-- Output: 10, 34, 160</span>
<span class="token keyword">end</span>

my_table<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">print</span><span class="token punctuation">(</span>my_table<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- Output: 3</span>
</code></pre>
<p>As you can see, our numbers are being doubled. But something weird is going on there at the end. We assign the number <code>3</code>, and it stays <code>3</code>. This is because <code>__newindex</code> only works for <ins>new</ins> indexes. Because <code>my_table[1]</code> already had a value, it doesn't trigger the event anymore.</p>
<h2 id="index" tabindex="-1">index <a class="anchor" href="#index">#</a></h2>
<p>The event <code>index</code> will trigger when trying to acces a property that the table doesn't have. With this, we can create special properties would normally take a function. Well, do they do take a function, but we don't need to call that function ourselves. We only need to access the non-existing property.</p>
<p>In the example below we have a triangle. We set the length of <code>a</code> and <code>b</code>, and let the metamethod calculate the length of <code>c</code>.</p>
<pre><code class="language-lua"><span data-attrs=""></span><span class="token keyword">local</span> my_triangle <span class="token operator">=</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">}</span>

<span class="token keyword">local</span> my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">-- As with normal properties, we can assign a metamethod like this.</span>
    __index <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">~=</span> <span class="token string">"c"</span> <span class="token keyword">then</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Unknown property "</span> <span class="token operator">..</span> key<span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token keyword">local</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">rawget</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rawget</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> b <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token punctuation">}</span>

<span class="token function">setmetatable</span><span class="token punctuation">(</span>my_triangle<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>my_triangle<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token comment">-- Output: 5</span>
my_triangle<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token function">print</span><span class="token punctuation">(</span>my_triangle<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token comment">-- Output: 10.77</span>
my_triangle<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">20</span>
<span class="token function">print</span><span class="token punctuation">(</span>my_triangle<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token comment">-- Output: 22.36</span>
</code></pre>
<p>Upon trying to access <code>c</code>, the metamethod return us a number calculated with the <a href="https://en.wikipedia.org/wiki/Pythagorean_theorem">Pythagorean theorem</a>. By changing <code>a</code> and <code>b</code>, we automatically change the value of <code>c</code>.</p>
<p>In the metamethod, we use <code>rawget(t, key)</code>. Similar to <code>rawset</code>, it is to get a value without triggering the event. In this case we wouldn't need it, since <code>my_triangle</code> definitely has the properties <code>a</code> and <code>b</code>, but it's always good to be safe.</p>


<footer class="guide-footer">
  <p></p>

  <p>By: 
  
      <em>Sheepolution</em>
    
  </p>
</footer>
      </article>
    </main>
  </body>
</html>