<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>LÖVE cookbook | Pixelation</title>

    <script src="/love-cookbook/assets/js/codeblock.js"></script>
    <script src="/love-cookbook/assets/js/hover_preview.js"></script>

    <link rel="stylesheet" href="/love-cookbook/assets/styles/fonts.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/main.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/prism.css">
    <link rel="stylesheet" href="/love-cookbook/assets/styles/markdown.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="sidebar">
    
      <header>
        <a href="/love-cookbook/">
            <div class="logo">
                <img class="logo-unhover-img" src="/love-cookbook/assets/logo.png">
                <img class="logo-hover-img" src="/love-cookbook/assets/logo_hover.png">
            </div>

            <h1>LÖVE Cookbook</h1>
        </a>
      </header>

      <nav class="table-of-contents">
        <ul class="chapters"><li class="group-header"><ul class="guides"><li><a class="" href="/love-cookbook/guides/getting-started/">Getting started</a>
                  </li></ul>

            </li><li class="group-header">Installation<ul class="guides"><li><a class="" href="/love-cookbook/guides/installation/love/">LÖVE</a>
                  </li><li><a class="" href="/love-cookbook/guides/installation/vscode/">VSCode</a>
                  </li><li><a class="" href="/love-cookbook/guides/installation/neovim/">Neovim</a>
                  </li></ul>

            </li><li class="group-header">Lua Basics<ul class="guides"><li><a class="" href="/love-cookbook/guides/lua-basics/lua/">Lua</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-basics/variables/">Variables</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-basics/functions/">Functions</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-basics/if-statements/">If-statements</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-basics/tables/">Tables and for-loops</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-basics/recap/">Recap</a>
                  </li></ul>

            </li><li class="group-header">Lua Intermediate<ul class="guides"><li><a class="" href="/love-cookbook/guides/lua-intermediate/require/">Require</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/scope/">Scope</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/modulo/">Modulo</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/nested-for-loops/">Nested for-loops</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/standard-library/">Standard library</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/string-patterns/">String patterns</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/ternary-operators/">Ternary operators</a>
                  </li><li><a class="" href="/love-cookbook/guides/lua-intermediate/metatables/">Metatables</a>
                  </li></ul>

            </li><li class="group-header">LÖVE Basics<ul class="guides"><li><a class="" href="/love-cookbook/guides/love/drawing-image/">Drawing an image</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/drawing-shapes/">Drawing shapes</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/playing-audio/">Playing audio</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/input/">Input</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/filesystem/">Filesystem</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/deltatime/">Deltatime</a>
                  </li><li><a class="" href="/love-cookbook/guides/love/reading-errors/">Reading errors</a>
                  </li></ul>

            </li><li class="group-header">Basics<ul class="guides"><li><a class="" href="/love-cookbook/guides/basic/aabb/">AABB</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/angle-and-distance/">Angle &amp; distance</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/tiles/">Tiles</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/animation/">Animation</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/saving-and-loading/">Saving &amp; loading</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/canvases/">Canvases</a>
                  </li><li><a class="" href="/love-cookbook/guides/basic/stencil-modes/">Stencil modes</a>
                  </li></ul>

            </li><li class="group-header">Intermediate<ul class="guides"><li><a class="" href="/love-cookbook/guides/intermediate/oop/">OOP</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/collision-resolving/">Collision resolution</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/stencil-states/">Stencil states</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/coroutines/">Coroutines</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/shaders/">Shaders</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/compute-shaders/">Compute Shaders</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/box-blur/">Box Blur</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/outlines/">Outlines</a>
                  </li><li><a class="" href="/love-cookbook/guides/intermediate/palette/">Palette</a>
                  </li><li><a class="active" href="/love-cookbook/guides/intermediate/pixelation/">Pixelation</a>
                  </li></ul>

            </li><li class="group-header">Advanced<ul class="guides"><li><a class="" href="/love-cookbook/guides/advanced/physics/">Physics</a>
                  </li><li><a class="" href="/love-cookbook/guides/advanced/threads/">Threads</a>
                  </li></ul>

            </li></ul>

      </nav>
    </div>

    <main>
      <article class="guide">
        
<h1 class="title">Pixelation</h1>

<div class="markdown-alert markdown-alert-caution"><p class="markdown-alert-title"><svg class="octicon octicon-stop mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</p><p>This guide is made for LÖVE 12.0!</p>
</div>
<p>For an introduction to shaders, see <a href="../shaders" data-preview="../shaders">Shaders</a></p>
<p>Pixelation is a cool effect that can be used to create a retro look.</p>
<p>To achieve a pixelation effect, we basically want to increase the amount of pixels a pixel in our game covers,</p>
<p>For this effect we'll run a shader to average the results of every 2x2 block, effectively halving the resolution of our game.<br>
We can use a trick to improve the memory efficiency of our effect by storing the results of that average in a half resolution image, since all pixels in that 2x2 block will have the same average.<br>
To increase the amount of pixelation our effect allows for we can keep downscaling like that until we achieve our desired resolution.</p>
<p><code>pixelationShader.fs</code></p>
<pre><code class="language-glsl"><span data-attrs=""></span><span class="token keyword">vec4</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token keyword">vec4</span> color<span class="token punctuation">,</span> Image tex<span class="token punctuation">,</span> <span class="token keyword">vec2</span> texture_coords<span class="token punctuation">,</span> <span class="token keyword">vec2</span> screen_coords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This shader will run on a half-resolution canvas</span>
    <span class="token comment">// meaning the texture_coords are in the center of a 2x2 pixel block</span>
    <span class="token comment">/*
    |---|---|
    | 0 | 1 |
    |---X---|
    | 2 | 3 |
    |---|---|
    */</span>

    <span class="token keyword">ivec2</span> size <span class="token operator">=</span> <span class="token function">textureSize</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Full-resolution size</span>
    <span class="token keyword">vec2</span> texelSize <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> size<span class="token punctuation">;</span> <span class="token comment">// Size of a texel</span>

    <span class="token comment">// Size we're offset 0.5 texels in each direction</span>
    <span class="token keyword">vec2</span> offset <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> texelSize<span class="token punctuation">;</span>

    <span class="token comment">// Calculate the positions on the Full-resolution canvas</span>
    <span class="token keyword">vec2</span> samplePosition0 <span class="token operator">=</span> texture_coords <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> samplePosition1 <span class="token operator">=</span> texture_coords <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> samplePosition2 <span class="token operator">=</span> texture_coords <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> samplePosition3 <span class="token operator">=</span> texture_coords <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span> <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Half-resolution size, converted to vec2, so we skip a few automatic conversions</span>
    <span class="token keyword">vec2</span> outputSize <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span>love_ScreenSize<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">vec4</span> average <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The gpu has something called a FMAD instruction, which is a Fused Multiply-Add</span>
    <span class="token comment">// Meaning we can multiply and add at the same time for no extra cost!</span>

    average <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> <span class="token function">texelFetch</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> <span class="token keyword">ivec2</span><span class="token punctuation">(</span>samplePosition0 <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> average<span class="token punctuation">;</span>
    average <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> <span class="token function">texelFetch</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> <span class="token keyword">ivec2</span><span class="token punctuation">(</span>samplePosition1 <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> average<span class="token punctuation">;</span>
    average <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> <span class="token function">texelFetch</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> <span class="token keyword">ivec2</span><span class="token punctuation">(</span>samplePosition2 <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> average<span class="token punctuation">;</span>
    average <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> <span class="token function">texelFetch</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> <span class="token keyword">ivec2</span><span class="token punctuation">(</span>samplePosition3 <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> average<span class="token punctuation">;</span>

    <span class="token keyword">return</span> average<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>main.lua</code></p>
<pre><code class="language-lua"><span data-attrs=""></span><span class="token keyword">local</span> pixelationShader <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newShader</span><span class="token punctuation">(</span><span class="token string">"pixelationShader.fs"</span><span class="token punctuation">)</span>

<span class="token comment">-- pixelScale must be an integer and a power of two</span>
<span class="token comment">-- pixelationCanvases can just be a table we define outside of our main loop</span>
<span class="token comment">-- the function will use this table to store the half-resultion canvases, it's a parameter</span>
<span class="token comment">-- because we need to release them when resizing "gameCanvas" or when changing the format</span>
<span class="token keyword">function</span> <span class="token function">pixelate</span><span class="token punctuation">(</span>gameCanvas<span class="token punctuation">,</span> pixelScale<span class="token punctuation">,</span> pixelationCanvases<span class="token punctuation">)</span>
    <span class="token comment">-- Will try to avoid doing anything if the scale is 1</span>
    <span class="token comment">-- Because then previousCanvas will be `gameCanvas` and a canvas can't be drawn to itself.</span>
    <span class="token keyword">if</span> pixelScale <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> width<span class="token punctuation">,</span> height <span class="token operator">=</span> gameCanvas<span class="token punctuation">:</span><span class="token function">getDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">-- Make sure we don't try to create a 0x0 canvas later</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>width <span class="token operator">/</span> pixelScale<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Pixel scale is too high for the canvas width"</span><span class="token punctuation">)</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>height <span class="token operator">/</span> pixelScale<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Pixel scale is too high for the canvas height"</span><span class="token punctuation">)</span>

    <span class="token comment">-- Though this is probably not used, it's good to have it here</span>
    <span class="token comment">-- So this code doesn't need to be edited if we change the format of our game canvas</span>
    <span class="token keyword">local</span> format <span class="token operator">=</span> gameCanvas<span class="token punctuation">:</span><span class="token function">getFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> settings <span class="token operator">=</span> <span class="token punctuation">{</span> format <span class="token operator">=</span> format <span class="token punctuation">}</span>

    <span class="token comment">-- Keep track of the full-size canvas relative to the one we're working on.</span>
    <span class="token keyword">local</span> previousCanvas <span class="token operator">=</span> gameCanvas

    <span class="token keyword">local</span> mode<span class="token punctuation">,</span> alphaMode <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getBlendMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">-- Disable any blending for the pixelation</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setBlendMode</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span>pixelationShader<span class="token punctuation">)</span>

    <span class="token keyword">local</span> scale <span class="token operator">=</span> <span class="token number">2</span>

    <span class="token comment">-- Create a canvas for each power of two scale if they don't exist yet</span>
    <span class="token comment">-- and draw the previous canvas to it.</span>
    <span class="token keyword">while</span> scale <span class="token operator">&lt;=</span> pixelScale <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> pixelationCanvases<span class="token punctuation">[</span>scale<span class="token punctuation">]</span> <span class="token keyword">then</span>
            pixelationCanvases<span class="token punctuation">[</span>scale<span class="token punctuation">]</span> <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newCanvas</span><span class="token punctuation">(</span>width <span class="token operator">/</span> scale<span class="token punctuation">,</span> height <span class="token operator">/</span> scale<span class="token punctuation">,</span> settings<span class="token punctuation">)</span>
            pixelationCanvases<span class="token punctuation">[</span>scale<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token string">"nearest"</span><span class="token punctuation">,</span> <span class="token string">"nearest"</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token keyword">local</span> canvas <span class="token operator">=</span> pixelationCanvases<span class="token punctuation">[</span>scale<span class="token punctuation">]</span>

        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setCanvas</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>previousCanvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>

        previousCanvas <span class="token operator">=</span> canvas

        scale <span class="token operator">=</span> scale <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">end</span>

    <span class="token comment">-- Draw the final canvas to the game canvas</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setCanvas</span><span class="token punctuation">(</span>gameCanvas<span class="token punctuation">)</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>previousCanvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> scale <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> scale <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment">-- Clean up</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setBlendMode</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> alphaMode<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre>


<footer class="guide-footer">
  <p></p>

  <p>By: 
  
      <em>Jasper</em>
    
  </p>
</footer>
      </article>
    </main>
    
  </body>
</html>